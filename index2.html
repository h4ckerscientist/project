<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>What to Do ?</title>
  <link rel="stylesheet" href="style2.css">
</head>
<body>

<header>
  <nav>
    <a href="#" data-tab="filters">Найти активность</a>
    <a href="#" data-tab="favorites">Избранное</a>
    <a href="#"><img src="media/Без имени-2.png" alt="home" style="size: 200px 200px;" class="logo"></a>
    <a href="#" data-tab="profile">Профиль</a>
    <a href="#" data-tab="auth">Войти</a>
    <img src="media/free-icon-location-pointer-619.png" alt="loc" class="loc">
    <p class="town"><span id="city"></span></p>

    <a href="#"><img src="media/free-icon-login-310818.png" alt="auth" class="auth"></a>
  </nav>
</header>

<div class="user-info">
    <p class="time"><span id="time">00:00</span></p>
    <p class="temp"><span id="weather">0 °C</span></p>

  </div>

<div class="container">

  <section id="filters" class="tab">
    <h2>Подберите активность</h2>
    <label>Настроение:</label>
    <select id="mood">
      <option>Весёлое</option>
      <option>Спокойное</option>
      <option>Активное</option>
      <option>Романтичное</option>
    </select>
    <label>Время дня:</label>
    <select id="time">
      <option>Утро</option>
      <option>День</option>
      <option>Вечер</option>
    </select>
    <label>Погода:</label>
    <select id="weather">
      <option>Ясно</option>
      <option>Дождь</option>
      <option>Облачно</option>
      <option>Снег</option>
    </select>
    <label>Бюджет (₽):</label>
    <input type="number" id="budget">
    <label>Количество людей:</label>
    <input type="number" id="people" value="1" min="1">
    <button class="btn" onclick="showRecommendations()">Показать рекомендации</button>
    <div id="results"></div>
  </section>

  <section id="favorites" class="tab">
    <h2>Избранное</h2>
    <div id="favoritesList"></div>
    <button class="btn" onclick="clearAllFavorites()">Очистить все избранные</button>
  </section>

  <section id="profile" class="tab">
    <h2>Профиль</h2>
    <div id="profileContent"></div>
    <h3>История активностей:</h3>
    <ul id="historyList"></ul>
    <button class="btn" onclick="clearHistory()">Очистить историю</button>
  </section>

  <section id="auth" class="tab">
    <h2>Войти или зарегистрироваться</h2>
    <label>Имя пользователя:</label>
    <input type="text" id="username">
    <label>Пароль:</label>
    <input type="password" id="password">
    <button class="btn" onclick="register()">Регистрация</button>
    <button class="btn" onclick="login()">Войти</button>
  </section>

</div>


<script>
const tabs = document.querySelectorAll('.tab');
const links = document.querySelectorAll('nav a');

links.forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    const target = link.getAttribute('data-tab');
    tabs.forEach(tab => tab.style.display = 'none');
    document.getElementById(target).style.display = 'block';
    links.forEach(item => item.classList.remove('active'));
    link.classList.add('active');
    if (target === 'favorites') loadFavorites();
    if (target === 'profile') updateProfile();
  });
});

function register() {
  const u = document.getElementById('username').value.trim();
  const p = document.getElementById('password').value;
  if (!u || !p) return alert('Введите данные.');
  if (localStorage.getItem(u)) return alert('Пользователь уже есть.');
  localStorage.setItem(u, p);
  localStorage.setItem('currentUser', u);
  alert('Регистрация успешна!');
  updateProfile();
}

function login() {
  const u = document.getElementById('username').value.trim();
  const p = document.getElementById('password').value;
  if (localStorage.getItem(u) === p) {
    localStorage.setItem('currentUser', u);
    alert('Вход выполнен!');
    updateProfile();
  } else alert('Неверные данные.');
}

function logout() {
  localStorage.removeItem('currentUser');
  updateProfile();
}

function updateProfile() {
  const u = localStorage.getItem('currentUser');
  const prof = document.getElementById('profileContent');
  if (u) {
    prof.innerHTML = `<p>Привет, <strong>${u}</strong>!</p><button class="btn" onclick="logout()">Выйти</button>`;
    loadHistory();
  } else prof.innerHTML = '<p>Вы не вошли.</p>';
}

function showRecommendations() {
  const m = mood.value, t = time.value, w = weather.value;
  const b = +budget.value || Infinity, p = +people.value;
  const res = document.getElementById('results');
  res.innerHTML = '';
  const matched = activities.filter(a =>
    a.mood === m && a.time.includes(t) && a.weather.includes(w) &&
    a.price <= b && a.people.includes(p)
  );
  if (!matched.length) return res.innerHTML = '<p>Ничего не найдено.</p>';
  matched.forEach(a => {
    const d = document.createElement('div');
    d.className = 'activity-card';
    d.id = `act-${a.id}`;
    d.innerHTML = `<strong>${a.name}</strong><p>${a.description}</p>
      <button class="btn" onclick="addToFavorites(${a.id}); removeRecommendation(${a.id})">В избранное</button>
      <button class="btn" onclick="addToHistory(${a.id}); removeRecommendation(${a.id})">Выполнить</button>`;
    res.appendChild(d);
  });
}

function removeRecommendation(id) {
  const el = document.getElementById(`act-${id}`);
  if (el) el.remove();
}

function addToFavorites(id) {
  const u = localStorage.getItem('currentUser');
  if (!u) return alert('Войдите.');
  const favs = JSON.parse(localStorage.getItem(`${u}_favorites`)||'[]');
  if (!favs.includes(id)) favs.push(id);
  localStorage.setItem(`${u}_favorites`, JSON.stringify(favs));
}

function loadFavorites() {
  const u = localStorage.getItem('currentUser');
  const cont = document.getElementById('favoritesList');
  if (!u) return cont.innerHTML = '<p>Войдите.</p>';
  const favs = JSON.parse(localStorage.getItem(`${u}_favorites`)||'[]');
  if (!favs.length) return cont.innerHTML = '<p>Пусто.</p>';
  cont.innerHTML = '';
  favs.forEach(id => {
    const a = activities.find(x=>x.id===id);
    if (a) {
      const d = document.createElement('div');
      d.className = 'activity-card';
      d.innerHTML = `<strong>${a.name}</strong><p>${a.description}</p>
        <button class="btn" onclick="repeatActivity(${a.id})">Повторить</button>
        <button class="remove-btn" title="Удалить" onclick="removeFromFavorites(${a.id})">✖</button>`;
      cont.appendChild(d);
    }
  });
}

function removeFromFavorites(id) {
  const u = localStorage.getItem('currentUser');
  const favs = JSON.parse(localStorage.getItem(`${u}_favorites`)||'[]');
  const newFavs = favs.filter(x=>x!==id);
  localStorage.setItem(`${u}_favorites`, JSON.stringify(newFavs));
  loadFavorites();
}

function clearAllFavorites() {
  const u = localStorage.getItem('currentUser');
  if (!u) return;
  if (confirm('Удалить все избранные?')) {
    localStorage.removeItem(`${u}_favorites`);
    loadFavorites();
  }
}

function repeatActivity(id) {
  addToHistory(id);
  alert('Добавлено в историю!');
}

function addToHistory(id) {
  const u = localStorage.getItem('currentUser');
  if (!u) return alert('Войдите.');
  const h = JSON.parse(localStorage.getItem(`${u}_history`)||'[]');
  h.push({id,time:new Date().toLocaleString()});
  localStorage.setItem(`${u}_history`, JSON.stringify(h));
  loadHistory();
}

function loadHistory() {
  const u = localStorage.getItem('currentUser');
  const list = document.getElementById('historyList');
  if (!u) return list.innerHTML = '';
  const h = JSON.parse(localStorage.getItem(`${u}_history`)||'[]');
  list.innerHTML = h.length ? h.map(e=>{
    const a=activities.find(x=>x.id===e.id);
    return `<li>${a.name} — ${e.time}</li>`;
  }).join('') : '<p>Пусто.</p>';
}

function clearHistory() {
  const u = localStorage.getItem('currentUser');
  if (!u) return;
  if (confirm('Очистить историю?')) {
    localStorage.removeItem(`${u}_history`);
    loadHistory();
  }
}

const activities = [
  {id:1,name:'Велопокатушки',description:'Катание в парке.',mood:'Активное',time:['День'],weather:['Ясно','Облачно'],price:0,people:[1,2,3]},
  {id:2,name:'Чтение книги',description:'Спокойное время.',mood:'Спокойное',time:['Вечер'],weather:['Дождь','Снег'],price:0,people:[1]},
  {id:2,name:'Чтение книги',description:'Спокойное время.',mood:'Спокойное',time:['День'],weather:['Ясно','Облачно'],price:0,people:[1]}
];

window.addEventListener('load',updateProfile);
</script>


<script src="scrypt3.js"></script>
</body>
</html>